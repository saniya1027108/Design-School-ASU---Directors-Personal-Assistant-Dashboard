<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Paola's Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{--page-max:1400px;--base:16px}
    html,body{font-size:var(--base);background:#fafcff}
    .container-fluid{max-width:var(--page-max)}
    .header{font-size:2.2rem;font-weight:700;text-align:center;margin-bottom:1rem}
    .kanban {display:flex;gap:1rem;margin-bottom:1rem}
    .col {background:#f8f9fa;padding:12px;border-radius:8px;flex:1;min-width:260px}
    .action-row{display:flex;gap:1rem;justify-content:center;margin-top:1rem}
    .action-box{min-width:300px;max-width:480px;background:#eef2f7;padding:22px;border-radius:12px;text-align:center;cursor:pointer;font-weight:600}
    .user-form{max-width:480px;margin:1.5rem auto}
  </style>
</head>
<body>
<div class="container-fluid py-4">
  <div class="header">Paola's Dashboard</div>

  <div id="user-pane" class="user-form">
    <form id="user-form">
      <div class="mb-2"><label class="form-label">Your Name</label><input id="user-name" class="form-control" required></div>
      <div class="mb-2"><label class="form-label">Your Email</label><input id="user-email" type="email" class="form-control" required></div>
      <button class="btn btn-primary w-100">Continue</button>
    </form>
  </div>

  <div id="main-dashboard" style="display:none;">
    <div class="kanban">
      <div class="col">
        <h6>To Do</h6>
        {% for item in action_items if item.status == 'todo' %}
          <div style="padding:8px;background:#fff;border-radius:6px;margin-bottom:8px">
            {{ item.text }}{% if item.due_date %}<div class="text-muted small">Due: {{ item.due_date }}</div>{% endif %}
          </div>
        {% endfor %}
      </div>
      <div class="col">
        <h6>Done</h6>
        {% for item in action_items if item.status == 'done' %}
          <div style="padding:8px;background:#fff;border-radius:6px;margin-bottom:8px">
            {{ item.text }}{% if item.due_date %}<div class="text-muted small">Due: {{ item.due_date }}</div>{% endif %}
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="action-row">
      <div class="action-box" id="reply-emails-box">ðŸ“§ Reply Emails</div>
      <div class="action-box" id="view-action-items-box">âœ… View Action Items</div>
    </div>

    <div class="text-center mt-4">
      <button id="sync-emails-btn" class="btn btn-outline-primary me-2">Sync Emails</button>
      <button id="extract-action-items-btn" class="btn btn-outline-success">Extract Action Items</button>
      <div id="dashboard-message" class="mt-3" style="display:none;"></div>
    </div>
  </div>
</div>

<script>
function showMsg(t,err){const el=document.getElementById('dashboard-message');el.style.display='block';el.className='mt-3 '+(err?'text-danger':'text-success');el.textContent=t;}
document.getElementById('sync-emails-btn').onclick = ()=>{ showMsg('Syncing...'); fetch('/sync_emails',{method:'POST'}).then(r=>r.json()).then(j=>{ if(j.success){ showMsg('Synced â€” reloading'); setTimeout(()=>location.reload(),800);} else showMsg('Sync failed',true);}).catch(()=>showMsg('Sync failed',true)); };
document.getElementById('extract-action-items-btn').onclick = ()=>{ showMsg('Extracting...'); fetch('/extract_action_items',{method:'POST'}).then(r=>r.json()).then(j=>{ if(j.success){ showMsg('Extracted â€” reloading'); setTimeout(()=>location.reload(),800);} else showMsg('Extract failed',true);}).catch(()=>showMsg('Extract failed',true)); };

document.getElementById('reply-emails-box').onclick = ()=> window.location.href = "{{ url_for('emails_full') }}";
document.getElementById('view-action-items-box').onclick = ()=> window.location.href = "{{ url_for('action_items_full') }}";

// user form handling
function saveUser(n,e){localStorage.setItem('user_name',n);localStorage.setItem('user_email',e);}
function loadUser(){return {name:localStorage.getItem('user_name'),email:localStorage.getItem('user_email')};}
document.getElementById('user-form').onsubmit = function(e){ e.preventDefault(); const n=document.getElementById('user-name').value.trim(), em=document.getElementById('user-email').value.trim(); if(n&&em){ saveUser(n,em); showMain(); } };
function showMain(){document.getElementById('user-pane').style.display='none';document.getElementById('main-dashboard').style.display='block';}
window.onload = function(){ const u=loadUser(); if(u.name && u.email) showMain(); };
</script>
</body>
</html>
